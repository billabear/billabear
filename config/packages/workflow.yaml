framework:
    workflows:
        cancellation_request:
            type: 'state_machine'
            marking_store:
                type: 'method'
                property: 'state'
            supports:
                - App\Entity\CancellationRequest
            initial_marking: started
            places:
                - started
                - subscription_cancelled
                - refund_issued
                - customer_notice_sent
                - internal_notice_sent
                - completed
            transitions:
                cancel_subscription:
                    from: started
                    to: subscription_cancelled
                issue_refund:
                    from: subscription_cancelled
                    to: refund_issued
                send_customer_notice:
                    from: refund_issued
                    to: customer_notice_sent
                send_internal_notice:
                    from: customer_notice_sent
                    to: completed

        subscription_creation:
            type: 'state_machine'
            marking_store:
                type: 'method'
                property: 'state'
            supports:
                - App\Entity\SubscriptionCreation
            initial_marking: started
            places:
                - started
                - stats_generated
                - customer_notice_sent
                - internal_notice_sent
                - completed
            transitions:
                handle_stats:
                    from: started
                    to: stats_generated
                send_customer_notice:
                    from: stats_generated
                    to: customer_notice_sent
                send_internal_notice:
                    from: customer_notice_sent
                    to: completed

        refund_created_process:
            type: 'state_machine'
            marking_store:
                type: 'method'
                property: 'state'
            supports:
                - App\Entity\RefundCreatedProcess
            initial_marking: started
            places:
                - started
                - stats_generated
                - customer_notice_sent
                - internal_notice_sent
                - completed
            transitions:
                handle_stats:
                    from: started
                    to: stats_generated
                send_customer_notice:
                    from: stats_generated
                    to: customer_notice_sent
                send_internal_notice:
                    from: customer_notice_sent
                    to: completed

        payment_creation:
            type: 'state_machine'
            marking_store:
                type: 'method'
                property: 'state'
            supports:
                - App\Entity\PaymentCreation
            initial_marking: started
            places:
                - started
                - receipt_generated
                - report_inputs_generated
                - customer_notice_sent
                - internal_notice_sent
                - completed
            transitions:
                create_receipt:
                    from: started
                    to: receipt_generated
                generate_report_data:
                    from: receipt_generated
                    to: report_inputs_generated
                send_customer_notice:
                    from: report_inputs_generated
                    to: customer_notice_sent
                send_internal_notice:
                    from: customer_notice_sent
                    to: completed

        stripe_import:
            type: 'state_machine'
            marking_store:
                type: 'method'
                property: 'state'
            supports:
                - App\Entity\StripeImport
            places:
                - started
                - customers
                - products
                - prices
                - subscriptions
                - payments
                - refunds
                - charge_backs
                - completed
            transitions:
                start:
                    from: started
                    to: customers
                start_customers:
                    from: customers
                    to: products
                start_products:
                    from: products
                    to: prices
                start_prices:
                    from: prices
                    to: subscriptions
                start_subscriptions:
                    from: subscriptions
                    to: payments
                start_payments:
                    from: payments
                    to: refunds
                start_refunds:
                    from: refunds
                    to: charge_backs
                start_charge_backs:
                    from: charge_backs
                    to: completed

        payment_failure_process:
            type: 'state_machine'
            marking_store:
                type: 'method'
                property: 'state'
            supports:
                - App\Entity\PaymentFailureProcess
            initial_marking: started
            places:
                - started
                - customer_notice_sent
                - internal_notice_sent
                - payment_retries
                - payment_failure_no_more_retries
                - payment_complete
            transitions:
                send_customer_notice:
                    from: started
                    to: customer_notice_sent
                send_internal_notice:
                    from: customer_notice_sent
                    to: payment_retries
                retries_failed:
                    from: payment_retries
                    to: payment_failure_no_more_retries
                payment_succeed:
                    from: payment_retries
                    to: payment_complete

